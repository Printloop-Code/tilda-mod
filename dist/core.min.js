((e,t)=>{"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["core.min"]=t():e["core.min"]=t()})(this,()=>{var o={"./src/utils/safeRouteIntegrationV2.ts":
/*!*********************************************!*\
  !*** ./src/utils/safeRouteIntegrationV2.ts ***!
  \*********************************************/(e,t,o)=>{o.r(t),o.d(t,{SafeRouteIntegrationV2:()=>n,initSafeRouteV2:()=>s});class n{constructor(){this.phoneData=null,this.initialized=!1,this.originalFormDataAppend=null,this.init()}init(){this.initialized||(console.log("[SafeRoute V2] ðŸš€ Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸..."),window.addEventListener("message",this.handleMessage.bind(this)),this.interceptFormData(),this.interceptXHR(),this.interceptFetch(),this.interceptSubmit(),this.initialized=!0,console.log("[SafeRoute V2] âœ… Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"),window.safeRouteV2=this)}handleMessage(e){if(e.origin.includes("saferoute.ru"))try{var t="string"==typeof e.data?JSON.parse(e.data):e.data,o=(console.log("[SafeRoute V2] ðŸ“¬ Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ SafeRoute"),this.extractPhone(t));o&&(console.log("[SafeRoute V2] ðŸ“± Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½:",o),this.setPhone(o))}catch(e){console.debug("[SafeRoute V2] ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸:",e)}}extractPhone(e){return e.phone||e.data?.contacts?.phone||e.contacts?.phone||e.recipient?.phone||null}setPhone(e){var t=this.parsePhone(e);if(t){this.phoneData=t,console.log("[SafeRoute V2] âœ… Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½:",this.phoneData);try{sessionStorage.setItem("sr_phone",JSON.stringify(this.phoneData))}catch(e){}this.fillPhoneFields()}else console.warn("[SafeRoute V2] âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ñ€Ð°ÑÐ¿Ð°Ñ€ÑÐ¸Ñ‚ÑŒ:",e)}parsePhone(e){e=e.replace(/\D/g,"");if(0===e.length)return null;let t=e;if(e.startsWith("7")&&11===e.length)t=e.substring(1);else if(e.startsWith("8")&&11===e.length)t=e.substring(1);else if(10!==e.length)return null;e=this.formatPhone(t);return{iso:"+7",number:e,full:"+7 "+e}}formatPhone(e){return 10!==e.length?e:`(${e.substring(0,3)}) ${e.substring(3,6)}-${e.substring(6,8)}-`+e.substring(8,10)}fillPhoneFields(){if(this.phoneData){var e=document.querySelectorAll("form");let n=!1;e.forEach(e=>{var t=this.ensureInput(e,"tildaspec-phone-part[]-iso","hidden"),o=this.ensureInput(e,"tildaspec-phone-part[]","tel"),e=this.ensureInput(e,"phone","hidden");t&&this.phoneData&&(t.value=this.phoneData.iso,n=!0),o&&this.phoneData&&(o.value=this.phoneData.number,n=!0),e&&this.phoneData&&(e.value=this.phoneData.full,n=!0)}),n&&console.log("[SafeRoute V2] âœ… ÐŸÐ¾Ð»Ñ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹")}}ensureInput(e,t,o){let n=e.querySelector(`input[name="${t}"]`);return n||((n=document.createElement("input")).type=o,n.name=t,n.style.display="none",e.appendChild(n),console.log("[SafeRoute V2] âž• Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ Ð¿Ð¾Ð»Ðµ:",t)),n}interceptFormData(){let t=this,o=window.FormData;window.FormData=function(e){e=new o(e);return!t.phoneData||e.has("phone")&&e.get("phone")||(e.set("tildaspec-phone-part[]-iso",t.phoneData.iso),e.set("tildaspec-phone-part[]",t.phoneData.number),e.set("phone",t.phoneData.full),console.log("[SafeRoute V2] ðŸ“¦ Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² FormData")),e},window.FormData.prototype=o.prototype,console.log("[SafeRoute V2] âœ… FormData Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‡ÐµÐ½")}interceptXHR(){let o=this,n=XMLHttpRequest.prototype.open,a=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,t,...o){return this._url=t,this._method=e,n.apply(this,[e,t,...o])},XMLHttpRequest.prototype.send=function(e){var t=this._url||"";return(t.includes("forms.tildaapi.com")||t.includes("/form/submit"))&&(console.log("[SafeRoute V2] ðŸŒ ÐŸÐµÑ€ÐµÑ…Ð²Ð°Ñ‚ XHR Ðº:",t),o.phoneData&&e instanceof FormData?e.has("phone")&&e.get("phone")||(e.set("tildaspec-phone-part[]-iso",o.phoneData.iso),e.set("tildaspec-phone-part[]",o.phoneData.number),e.set("phone",o.phoneData.full),console.log("[SafeRoute V2] âœ… Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² XHR")):!o.phoneData||"string"!=typeof e||(t=new URLSearchParams(e)).has("phone")&&t.get("phone")||(t.set("tildaspec-phone-part[]-iso",o.phoneData.iso),t.set("tildaspec-phone-part[]",o.phoneData.number),t.set("phone",o.phoneData.full),e=t.toString(),console.log("[SafeRoute V2] âœ… Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² XHR (URLEncoded)"))),a.call(this,e)},console.log("[SafeRoute V2] âœ… XMLHttpRequest Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‡ÐµÐ½")}interceptFetch(){let n=this,a=window.fetch;window.fetch=function(e,t){var o="string"==typeof e?e:e instanceof URL?e.href:e.url;return(o.includes("forms.tildaapi.com")||o.includes("/form/submit"))&&(console.log("[SafeRoute V2] ðŸŒ ÐŸÐµÑ€ÐµÑ…Ð²Ð°Ñ‚ fetch Ðº:",o),n.phoneData)&&t?.body instanceof FormData&&(t.body.has("phone")&&t.body.get("phone")||(t.body.set("tildaspec-phone-part[]-iso",n.phoneData.iso),t.body.set("tildaspec-phone-part[]",n.phoneData.number),t.body.set("phone",n.phoneData.full),console.log("[SafeRoute V2] âœ… Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² fetch"))),a.apply(window,[e,t])},console.log("[SafeRoute V2] âœ… fetch Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‡ÐµÐ½")}interceptSubmit(){document.addEventListener("submit",e=>{e=e.target;if(console.log("[SafeRoute V2] ðŸ“¤ Submit Ñ„Ð¾Ñ€Ð¼Ñ‹:",e.action),this.phoneData&&this.fillPhoneFields(),!this.phoneData)try{var t=sessionStorage.getItem("sr_phone");t&&(this.phoneData=JSON.parse(t),this.fillPhoneFields())}catch(e){}},!0),console.log("[SafeRoute V2] âœ… Submit Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‡ÐµÐ½")}getPhone(){return this.phoneData}}let a=null;function s(){return a=a||new n}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()}},n={};function a(e){var t=n[e];return void 0!==t||(t=n[e]={exports:{}},o[e](t,t.exports,a)),t.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};{
/*!*****************************!*\
  !*** ./src/entries/core.ts ***!
  \*****************************/
a.r(t),a.d(t,{default:()=>e});var s=a(/*! ../utils/safeRouteIntegrationV2 */"./src/utils/safeRouteIntegrationV2.ts");(0,s.initSafeRouteV2)();let e=s={init:s.initSafeRouteV2}}return t});